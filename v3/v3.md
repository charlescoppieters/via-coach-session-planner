# VIA Session Planner v3 - Complete Specification

---

## Overall Goals

**"The Funnel"**
The coaches are able to input their long term planning (Playing and training methodology as well as their player profiling. They can also input their team information of players and attach IDPs to them. They will be able to plan their session and then reflect on their session).

**"The AI Training"**
The platform will be able to assess and analyse the data inputted and prompt coaches depending on their context to support their planning processes. This would occur both when they analyse their team/squad in the "My Team" area as well as when they are directly designing a session in the "Session Planning Area".


---

## Roles & Permissions

There are two roles in the system:

### Admin

Admins have full abilities to do everything:
- This is the permission you automatically have when signing up to the platform (not from an invite link)
- Has ability to view and edit Club Methodology
- Has ability to view club details, edit club details, add/invite new coaches and manage their permissions
- Can add/edit/delete players, move players between any teams
- Can create new teams, delete teams
- Plus all features of a normal Coach
- **Anyone can be assigned as Admin and there can be unlimited Admins per club**

### Coach

Coaches join from an invite link:
- Admin must assign them to be a coach for one or more teams
- Once assigned to teams, they can create session plans for those teams
- They have **read access to all players in the club** and can assign any player to teams they coach (or unassign them)
- Can create session blocks
- Can access all session blocks from the club (and default/system session blocks)
- Can edit their team's methodology (but cannot see or edit Club Methodology)


---

## Coach Sign Up & Invite Flow

### Direct Sign Up (New Admin)

1. Coach enters email
2. OTP verification
3. Coach is automatically made an **Admin** of a new club
4. Proceed to onboarding (create first team, set up club methodology)

### Invite Flow (New Coach)

1. Admin generates a **one-time invite link** tied to a specific email address
2. Invited coach clicks the link
3. Coach enters the email (must match the invite)
4. OTP verification
5. Coach is automatically associated with the club as a **Coach** role
6. Admin assigns them to team(s)

**Invite Link Behavior:**
- Each invite link is single-use (expires after first use)
- Invite is tied to a specific email address
- If the email doesn't match, the invite is rejected


---

## Data Ownership

**All data belongs to the club, not individual coaches.** This is a foundational principle that affects how the database is structured.

- All entities (players, teams, sessions, methodology, etc.) are owned by the club
- Players can be moved between teams within the same club
- Teams can be reassigned to different coaches within the club
- Only Admins can delete data (players, teams, sessions, etc.)

**Database Implication:** All major entities should have `club_id` as the primary ownership reference, not `coach_id`. Coaches are assigned to teams, but they don't "own" the data - the club does.


---

## Sidebar Structure

The sidebar structure differs based on whether you are an Admin or a Coach.

**Admin Sidebar:**
- Dashboard
- Club Methodology (Admin only)
- My Methodology
- Session Planning
- My Team
  - Players
  - Team Settings
- Club Settings (above logout, Admin only)
- Logout

**Coach Sidebar:**
- Dashboard
- My Methodology
- Session Planning
- My Team
  - Players
  - Team Settings
- Coach Settings (above logout)
- Logout


---

## Club Methodology (Admin Only)

Admins have a sidebar section called "Club Methodology". This serves as the **template** for all teams in the club.

Club Methodology has three categories:
1. Playing Methodology
2. Training Methodology
3. Positional Profiling

**Key Behavior:**
- When a new team is created, it automatically gets a **full copy** of the Club Methodology
- Changes to Club Methodology do **NOT** automatically propagate to existing teams
- Teams keep their own independent copy that can be customized
- The Club Methodology serves as the starting template and the source for "revert" operations

### Playing Methodology

How you want your team to play during matches.

- A list of "Zones" (rules) with title and description
- Each zone explains what that playing zone does
- Admins can add, edit, delete, and reorder zones

![Playing Methodology](./playing-methodology.png)

### Training Methodology

How you plan to train your players, including practice design, coaching style, and key themes.

- A list of training rules with title and description
- Admins can add, edit, delete, and reorder rules

### Positional Profiling

Clear descriptions of each position that align with your playing style and team structure.

- List of positions that can be expanded
- "Advanced options" with position variants (e.g., Inverted Fullback, Defensive Fullback)
- Option to "suggest new" position for review
- Activate/deactivate positions
- When expanded, select up to 5 attributes most important to that position
- Default attributes are pre-selected but can be customized
- Option to add custom attributes

![Positional Profiling](./positional-profiling.png)
![Edit Positions](./edit-positions.png)


---

## My Methodology (Team-Level)

"My Methodology" shows the methodology for the currently selected team. It has the same three categories as Club Methodology:

1. Playing Methodology
2. Training Methodology
3. Positional Profiling

**On Team Creation:** When a team is created, it automatically receives its own records for all three methodology types, copied from the current club-level methodology. These team-level records are then associated with that team only.

### 1. Playing Methodology (Team-Level)

**Inheritance:** On team creation, the team receives a full copy of the club's playing methodology (zones, descriptions, objectives, etc.).

**Editing:** Coaches assigned to the team can fully edit the team's playing methodology:
- Add, edit, delete, and reorder zones
- Modify zone descriptions and objectives
- Changes only affect this specific team

**Revert Button:** A "Revert to Club Playing Methodology" button replaces the team's playing methodology with a fresh copy of the **current** club playing methodology. This is a destructive action that overwrites all team-level customizations.

**Key Behavior:**
- Club changes do NOT automatically propagate to teams
- Teams maintain fully independent copies
- Revert pulls the current club state (not the original state from team creation)

### 2. Training Methodology (Team-Level)

**Inheritance:** On team creation, the team receives references to all club training rules.

**Club Rules Behavior at Team Level:**
- Club training rules are **always visible** in the team's training methodology
- Club rules **cannot be edited or deleted** at the team level
- Club rules can be **toggled on/off** with a toggle button (enabled by default)
- When a club rule is toggled off, it is hidden from session planning for that team but still exists in the list
- **If club training rules change (add/edit/delete), the team-level view automatically reflects those changes**

**Team-Specific Rules:**
- Coaches can **add new rules** specific to their team
- Team-specific rules appear in addition to club rules
- Team-specific rules are fully editable and deletable by the team's coaches
- Team-specific rules are visually distinguished from club rules (e.g., different styling or label)

**No Revert Button:** Since club rules are always synced and team rules are additive, there is no revert button for training methodology.

### 3. Positional Profiling (Team-Level)

**Inheritance:** On team creation, the team receives a full copy of the club's positional profiling (positions, variants, attributes, etc.).

**Editing:** Coaches assigned to the team can fully edit the team's positional profiling:
- Activate/deactivate positions
- Customize position attributes (select up to 5)
- Add custom attributes
- Changes only affect this specific team

**Revert Button:** A "Revert to Club Positional Profiling" button replaces the team's positional profiling with a fresh copy of the **current** club positional profiling. This is a destructive action that overwrites all team-level customizations.

**Key Behavior:**
- Club changes do NOT automatically propagate to teams
- Teams maintain fully independent copies
- Revert pulls the current club state (not the original state from team creation)

### Summary Table

| Aspect | Playing Methodology | Training Methodology | Positional Profiling |
|--------|---------------------|----------------------|----------------------|
| On team creation | Full copy from club | References to club rules | Full copy from club |
| Club rules/data editable? | N/A (independent copy) | No (read-only, toggle only) | N/A (independent copy) |
| Team can add new? | Yes (edit existing copy) | Yes (additional rules) | Yes (edit existing copy) |
| Club changes propagate? | No | Yes (club rules sync) | No |
| Revert button? | Yes | No | Yes |
| Revert behavior | Overwrites with current club | N/A | Overwrites with current club |


---

## Team Settings

Team Settings appears in the sidebar under "My Team". It contains all team-specific configuration.

### Team Information

- Team name
- Age group
- Skill level
- Player count
- Sessions per week
- Session duration
- Gender (optional)

### Facilities

- **"How much space do you have?"** - dropdown list:
  - Full Pitch
  - Half Pitch
  - Quarter Pitch
  - Indoor Hall
  - Other (free text input)
- **"What equipment do you have access to?"** - equipment type and quantity:
  - Full Size Goal
  - Mini Goal
  - Cones
  - Balls
  - Bibs
  - Mannequins
  - Poles
  - Ladders
  - Hurdles
  - (Custom equipment types can be added)
- **"Are there any other factors to consider?"** - open text field

![My Facilities](./my-facilities.png)

### Coach Assignment

- Assign multiple coaches to the team (no limit)
- Assigned coaches get:
  - Access to view and edit the team's methodology
  - Ability to edit team details
  - Ability to create and manage sessions for that team
- Only Admins can add/remove coaches from a team


---

## Dashboard

The Dashboard tab provides an overview of recent and upcoming sessions.

- Box showing the most recent past session and the upcoming session
- "View all previous sessions" button opens a page with all previous sessions
  - Coach can expand both the session plan and reflections for each session
- Past sessions are highlighted if the coach has not yet reflected on them
- "Review session" button opens reflection page with:
  - List of reflection questions
  - Option to record audio (nice to have: audio summarization)


---

## Session Planning

### Session List

- View the next session, future sessions, and previous completed sessions
- Filter by upcoming/past
- Sessions are scoped to the currently selected team

### Session Detail

When opening a session:
- Some predetermined information is filled in based on methodology
- View session blocks (number determined by methodology)
- Click on each block to edit that part of the session
- AI Coach appears to prompt around session setup
- Coach can ask direct questions to support planning
- Export the entire session as a PDF
- "Suggestions" icon showing:
  - Coach's own suggestions
  - AI suggestions from methodology and analysis
- Data point prompts for targets

### Session Blocks Architecture

Session blocks are **reusable content units** that coaches can create, save, and use across multiple sessions. This allows coaches to build a personal library of drills, exercises, and activities.

**Block Content:**
- `title` - Name of the block/drill
- `description` - Detailed explanation of the activity
- `coaching_points` - Key coaching cues and focus areas
- `image_url` - Visual diagram or photo of the setup
- `diagram_data` - Structured data for interactive pitch diagrams
- `duration` - Estimated time in minutes

**Ownership & Sharing:**
- `creator_id` - The coach who created the block
- `club_id` - Club association for shared blocks
- `is_public` - Whether the block is visible to other coaches
- `source` - Origin of the block:
  - `user` - Created by a coach
  - `system` - Pre-built blocks provided by VIA
  - `marketplace` - Blocks from future marketplace feature

**Block Access:**
- All coaches can view: their own blocks, all club blocks, system blocks
- All coaches can create new blocks
- Coaches can only edit/delete their own blocks

**Block Assignments:**
Blocks are linked to sessions via `session_block_assignments`, which tracks:
- Which block is used in which session
- The `position` (order) of the block within the session

This many-to-many relationship allows:
- The same block to be reused across multiple sessions
- Coaches to build a personal block library over time
- Future marketplace features for sharing/purchasing blocks


---

## My Team

### Players Sub-Section

- View all players in the club (read access for all coaches)
- Coaches can assign any club player to teams they coach (or unassign them)
- Add new players (Admins only, or coaches for their teams)
- Assign players a position from team's Positional Profiling
- Assign IDPs (Individual Development Plans) based on position
- IDP suggestions come from the position's attributes in Positional Profiling
- Custom IDP option available
- "?" tooltip explaining IDP source

### Player Detail

- Player information (name, age, gender)
- Position (dropdown from team's positional profiling)
- IDP targets (up to 3)
- Edit/delete player (Admin only for delete)
- Move to different team (Admin only)

### Analysis Sub-Tab (Future)

- Data regarding team's outcomes
- Dropdown to select individual player
- "Suggestions" button for areas not focused on
- Assign suggestions to future sessions
- "Insufficient data" message when not enough data collected


---

## Club Settings (Admin Only)

Club Settings appears in the sidebar above the Logout button. Only visible to Admins.

### Club Information

- Club name and branding
- Club logo upload

### Coach Management

- View all coaches in the club
- See which teams each coach is assigned to
- See each coach's role (Admin or Coach)
- **Invite new coaches** - Generate one-time invite link for specific email
- Remove coaches from the club
- Change coach roles (promote Coach to Admin, or demote)

### Invite System

- Admin enters email address to invite
- System generates a one-time invite link
- Link is tied to that specific email
- Link expires after first use
- Admin can see pending invites and revoke them


---

## Coach Settings (All Coaches)

For non-Admin coaches, this section is called "Coach Settings".

### Coach Profile

- View and edit their own profile information
- Profile picture upload
- Name editing
- Email display (read-only)
- View current role (read-only)
- View club name (read-only)


---

## Future Implementation: IDP Feedback Loop

After completing the structural work, we will implement the Session ↔ IDP feedback loop:

- When coaches complete post-session reflections, LLM analysis categorizes the session
- Analysis determines which parts of each player's IDP were worked on
- Data feeds into Analysis sub-tab to power "Suggestions" feature
- Coaches can see how frequently each IDP target has been addressed

This creates a closed loop: Methodology → Sessions → Reflection → Analysis → Suggestions → Future Sessions


---

# Technical Decisions

## 1. Data Migration

**Decision:** Fresh start - no existing users to migrate. New database schema from scratch.

## 2. Invite Link Format

**Decision:** Invite links use a secure random token (UUID or similar). The token is stored with:
- The invited email address
- The club ID
- Creation timestamp
- Used/unused status

Example: `https://app.via.com/invite/a1b2c3d4-e5f6-7890-abcd-ef1234567890`

## 3. Methodology Inheritance Behavior

**Decision:** **Copy on team creation** - When a team is created, all three methodology sections (Playing, Training, Positional Profiling) are copied from Club Methodology to the new team.

- Team methodology is fully independent after creation
- Changes to Club Methodology do NOT propagate to existing teams
- Each methodology section has a "Revert to Club Methodology" button
- Revert replaces team data with a fresh copy of current Club Methodology

## 4. Real-Time Sync

**Decision:** Use Supabase Realtime subscriptions for live updates within a team's data (e.g., when two coaches are editing the same team).

## 5. Confirmation Dialogs

**Decision:** Require confirmation for destructive actions:
- Deleting a club
- Removing a coach from the club
- Removing the only coach from a team
- Deleting a team
- Deleting a player
- Reverting team methodology to club methodology

## 6. Defaults & Templates Architecture

**Decision:** Two-table system for flexibility and future monetization.

### System Defaults Table

For basic editable defaults (positions, attributes, equipment, space options).

```sql
CREATE TABLE system_defaults (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  category TEXT NOT NULL,  -- 'positions', 'attributes', 'equipment', 'space_options'
  key TEXT NOT NULL,
  value JSONB NOT NULL,
  display_order INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(category, key)
);
```

### Methodology Templates Table (Future)

For purchasable methodology packages.

```sql
CREATE TABLE methodology_templates (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name TEXT NOT NULL,
  source TEXT NOT NULL,
  template_type TEXT NOT NULL,
  content JSONB NOT NULL,
  description TEXT,
  logo_url TEXT,
  is_premium BOOLEAN DEFAULT false,
  price_cents INTEGER,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

## 7. Routing Architecture

**Decision:** Next.js file-based routing with route groups.

### Route Structure

```
src/app/
├── (auth)/
│   ├── layout.tsx
│   ├── login/page.tsx              # /login
│   ├── verify/page.tsx             # /verify (OTP)
│   ├── invite/[token]/page.tsx     # /invite/abc123 (invite link)
│   └── onboarding/page.tsx         # /onboarding
│
├── (dashboard)/
│   ├── layout.tsx
│   ├── page.tsx                    # / (Dashboard)
│   │
│   ├── club-methodology/           # Admin only
│   │   ├── page.tsx
│   │   ├── playing/page.tsx
│   │   ├── training/page.tsx
│   │   └── profiling/page.tsx
│   │
│   ├── methodology/                # Team methodology
│   │   ├── page.tsx
│   │   ├── playing/page.tsx
│   │   ├── training/page.tsx
│   │   └── profiling/page.tsx
│   │
│   ├── session-planning/
│   │   ├── page.tsx
│   │   └── [id]/page.tsx
│   │
│   ├── my-team/
│   │   ├── players/
│   │   │   ├── page.tsx
│   │   │   └── [id]/page.tsx
│   │   ├── settings/page.tsx
│   │   └── analysis/page.tsx
│   │
│   └── settings/
│       ├── page.tsx                # Coach profile
│       ├── club/page.tsx           # Admin only - club info
│       └── coaches/page.tsx        # Admin only - manage coaches
│
└── api/
    └── ai/coach/route.ts
```

## 8. Session Blocks Architecture

**Decision:** Reusable blocks with many-to-many relationship to sessions.

### Database Structure

**`session_blocks` table:**
```sql
CREATE TABLE session_blocks (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  title TEXT NOT NULL,
  description TEXT,
  coaching_points TEXT,
  image_url TEXT,
  diagram_data JSONB,
  duration INTEGER,
  creator_id UUID NOT NULL REFERENCES coaches(id),
  club_id UUID REFERENCES clubs(id),
  is_public BOOLEAN DEFAULT FALSE,
  source TEXT DEFAULT 'user' CHECK (source IN ('user', 'system', 'marketplace')),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

**`session_block_assignments` table:**
```sql
CREATE TABLE session_block_assignments (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  session_id UUID NOT NULL REFERENCES sessions(id) ON DELETE CASCADE,
  block_id UUID NOT NULL REFERENCES session_blocks(id) ON DELETE CASCADE,
  position INTEGER NOT NULL DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(session_id, block_id)
);
```

### Access Rules

- Coaches can view: their own blocks, club blocks, system blocks
- Coaches can edit/delete: only their own blocks
- Blocks can be assigned to any session the coach has access to


---

# Implementation Plan

## Phase 1: Database Schema

### New Tables

1. **`clubs`**
   ```sql
   - id UUID PRIMARY KEY
   - name TEXT NOT NULL
   - logo_url TEXT
   - created_at TIMESTAMPTZ
   - updated_at TIMESTAMPTZ
   ```

2. **`club_invites`** (new for invite system)
   ```sql
   - id UUID PRIMARY KEY
   - club_id UUID REFERENCES clubs
   - email TEXT NOT NULL
   - token TEXT UNIQUE NOT NULL
   - created_by UUID REFERENCES coaches
   - used_at TIMESTAMPTZ (NULL until used)
   - created_at TIMESTAMPTZ
   ```

3. **`club_memberships`**
   ```sql
   - id UUID PRIMARY KEY
   - club_id UUID REFERENCES clubs
   - coach_id UUID REFERENCES coaches
   - role TEXT NOT NULL ('admin' or 'coach')
   - joined_at TIMESTAMPTZ
   - UNIQUE(club_id, coach_id)
   ```

4. **`team_coaches`**
   ```sql
   - id UUID PRIMARY KEY
   - team_id UUID REFERENCES teams
   - coach_id UUID REFERENCES coaches
   - assigned_at TIMESTAMPTZ
   - UNIQUE(team_id, coach_id)
   ```

5. **`system_defaults`** - See Technical Decisions

6. **`playing_methodology`**
   ```sql
   - id UUID PRIMARY KEY
   - club_id UUID REFERENCES clubs (for club-level)
   - team_id UUID REFERENCES teams (for team-level, NULL for club)
   - zones JSONB (array of zone objects with coordinates, title, description, color)
   - created_at TIMESTAMPTZ
   - updated_at TIMESTAMPTZ
   ```

   **Note:** For team-level playing methodology:
   - On team creation, copy the club's zones JSONB to a new team record
   - Teams have their own independent record that can be fully edited
   - "Revert" replaces team zones with current club zones

7. **`training_methodology`** (Club-level rules only)
   ```sql
   - id UUID PRIMARY KEY
   - club_id UUID REFERENCES clubs
   - team_id UUID (NULL - club rules don't have team_id)
   - title TEXT NOT NULL
   - description TEXT
   - display_order INTEGER
   - is_active BOOLEAN DEFAULT true
   - created_at TIMESTAMPTZ
   - updated_at TIMESTAMPTZ
   ```

8. **`team_training_rules`** (Team-specific additional rules)
   ```sql
   - id UUID PRIMARY KEY
   - team_id UUID REFERENCES teams NOT NULL
   - title TEXT NOT NULL
   - description TEXT
   - display_order INTEGER
   - is_active BOOLEAN DEFAULT true
   - created_at TIMESTAMPTZ
   - updated_at TIMESTAMPTZ
   ```

9. **`team_training_rule_toggles`** (Toggle club rules on/off per team)
   ```sql
   - id UUID PRIMARY KEY
   - team_id UUID REFERENCES teams NOT NULL
   - training_rule_id UUID REFERENCES training_methodology NOT NULL
   - is_enabled BOOLEAN DEFAULT true
   - created_at TIMESTAMPTZ
   - updated_at TIMESTAMPTZ
   - UNIQUE(team_id, training_rule_id)
   ```

   **Note:** For training methodology at team level:
   - Club rules are always fetched from `training_methodology` (live sync)
   - Teams can toggle club rules via `team_training_rule_toggles`
   - Teams can add their own rules via `team_training_rules`
   - No copying or revert needed - club rules always reflect current state

10. **`positional_profiles`**
    ```sql
    - id UUID PRIMARY KEY
    - club_id UUID REFERENCES clubs
    - team_id UUID REFERENCES teams (NULL for club-level)
    - position_key TEXT NOT NULL
    - custom_position_name TEXT
    - attributes JSONB (array of up to 5 attribute keys)
    - is_active BOOLEAN DEFAULT true
    - display_order INTEGER
    - created_at TIMESTAMPTZ
    - updated_at TIMESTAMPTZ
    ```

    **Note:** For team-level positional profiling:
    - On team creation, copy all club positional_profiles records to new team records
    - Teams have their own independent records that can be fully edited
    - "Revert" deletes all team records and copies current club records

11. **`team_facilities`**
   ```sql
   - id UUID PRIMARY KEY
   - team_id UUID REFERENCES teams
   - space_type TEXT
   - custom_space TEXT
   - equipment JSONB
   - other_factors TEXT
   - created_at TIMESTAMPTZ
   - updated_at TIMESTAMPTZ
   ```

12. **`session_blocks`** - See Technical Decisions

13. **`session_block_assignments`** - See Technical Decisions

### Tables to Modify

1. **`teams`** - Add `club_id`, remove direct `coach_id`
2. **`players`** - Add `club_id`, keep `team_id`
3. **`sessions`** - Add `club_id`, keep `team_id` and `coach_id`

---

## Phase 2: Auth & Invite System

1. Build login page (email entry)
2. Build OTP verification page
3. Build invite link handler (`/invite/[token]`)
4. Update AuthContext with club/role info
5. Create invite generation UI for Admins
6. Set up middleware for auth and role protection

---

## Phase 3: Settings Pages

1. Build `/settings` page (coach profile)
2. Build `/settings/club` page (Admin only - club info)
3. Build `/settings/coaches` page (Admin only - coach management, invites)
4. Implement role-based route protection
5. Build confirmation modals

---

## Phase 4: Club Methodology (Admin)

1. Build club methodology layout with sub-navigation
2. Build playing methodology page with CRUD
3. Build training methodology page with CRUD
4. Build positional profiling page
5. Build position edit modal
6. Build attribute selection UI (max 5)

---

## Phase 5: Team Creation & Settings

1. Build team creation flow
2. Implement methodology copy on team creation:
   - Copy club playing_methodology record to new team record
   - Copy all club positional_profiles records to new team records
   - (Training methodology: no copy needed - teams reference club rules directly)
3. Build team settings page
4. Build facilities section
5. Build coach assignment section
6. Implement team selector in sidebar

---

## Phase 6: My Methodology (Team-Level)

### 6a. Playing Methodology (Team)
1. Create team-level playing methodology page with edit capability
2. Fetch team's own playing_methodology record (not club's)
3. Allow full editing of zones (add, edit, delete, reorder)
4. Add "Revert to Club Playing Methodology" button
5. Implement revert: copy current club zones to team record
6. Add confirmation dialog for revert action

### 6b. Training Methodology (Team)
1. Create team-level training methodology page
2. Fetch and display club training rules (live from training_methodology table)
3. Add toggle button for each club rule (enabled/disabled per team)
4. Store toggle state in team_training_rule_toggles table
5. Allow coaches to add team-specific rules (team_training_rules table)
6. Team rules are fully editable/deletable
7. Visually distinguish club rules (read-only with toggle) from team rules (editable)
8. No revert button needed - club rules always sync automatically

### 6c. Positional Profiling (Team)
1. Create team-level positional profiling page with edit capability
2. Fetch team's own positional_profiles records (not club's)
3. Allow full editing (activate/deactivate, customize attributes)
4. Add "Revert to Club Positional Profiling" button
5. Implement revert: delete team records, copy current club records
6. Add confirmation dialog for revert action

### 6d. Database Migrations
1. Create team_training_rules table
2. Create team_training_rule_toggles table
3. Add team_id to playing_methodology (if not exists)
4. Add RPC functions for methodology copy on team creation
5. Add RPC function for revert operations

---

## Phase 7: My Team / Players

1. Build players list page (all club players visible)
2. Build player detail page
3. Implement player assignment to teams
4. Build IDP selection from positional profiling
5. Build analysis page placeholder

---

## Phase 8: Dashboard & Session Planning

1. Update dashboard to use team context
2. Update session list to filter by team
3. Update session creation
4. Update AI coach context with methodology
5. Implement session blocks UI

---

## Phase Summary

| Phase | Focus | Key Deliverables |
|-------|-------|------------------|
| 1 | Database | New schema with invite system |
| 2 | Auth | Login, OTP, magic link invites |
| 3 | Settings | Club/Coach settings, invites UI |
| 4 | Club Methodology | Admin methodology management |
| 5 | Team Creation | Team flow, methodology copy on creation |
| 6a | Team Playing Methodology | Editable zones + revert to club |
| 6b | Team Training Methodology | Club rules (toggle) + team rules (editable) |
| 6c | Team Positional Profiling | Editable profiles + revert to club |
| 6d | Methodology DB Migrations | New tables + RPC functions |
| 7 | Players | Player management, club-wide visibility |
| 8 | Dashboard/Sessions | Update existing features |


---

## Appendix: System Defaults

Default positions, attributes, equipment, and space options are defined in `v2/seed.sql`. This seed data populates the `system_defaults` table and includes:

- **Positions**: 8 standard positions + 18 advanced variants with default attributes
- **Attributes**: Technical, Physical, Mental, and Goalkeeping categories
- **Equipment**: Goals, cones, balls, bibs, mannequins, etc.
- **Space Options**: Full pitch, half pitch, quarter pitch, indoor hall, other
