# VIA Session Planner v2 - Complete Specification

---

## Overall Goals

**"The Funnel"**
The coaches are able to input their long term planning (Playing and training methodology as well as their player profiling. They can also input their team information of players and attach IDPs to them. They will be able to plan their session and then reflect on their session).

**"The AI Training"**
The platform will be able to assess and analyse the data inputted and prompt coaches depending on their context to support their planning processes. This would occur both when they analyse their team/squad in the "My team" area as well as when they are directly designing a session in the "Session Planning Area".


---

## Club/Coach Sign Up

When a coach signs up, they have two options:
1. Enter a club code
2. Create new club

If they enter a club code, they join an existing club and have to select a role that is not head coach. If they create a new club, they are the 'head coach' automatically and do not select a role. The head coach will have increased permissions. The head coach can define methodology rules (for every part of methodology) that applies to ALL coaches, teams, and players under them. Only the head coach can change these, and these methodology rules will have a club badge next to them indicating that they are a club-wide methodology rule. These rules will show up for all coaches at the club.


---

## Data Ownership (IMPORTANT for Database Design)

**All data belongs to the club, not individual coaches.** This is a foundational principle that affects how the database is structured.

- All entities (players, teams, sessions, methodology rules, etc.) are owned by the club
- Players can be moved between teams within the same club
- Teams can be reassigned to completely different coaches within the club
- The head coach role can be transferred to another coach in the club
- Only the head coach can delete any data (players, teams, sessions, etc.)

**Database Implication:** All major entities should have `club_id` as the primary ownership reference, not `coach_id`. Coaches are assigned to teams, but they don't "own" the data - the club does. This allows for flexibility in reassigning coaches, moving players, and transferring head coach responsibilities without losing or orphaning data.


---

## Sidebar Structure

The sidebar structure differs based on whether you are a head coach or a regular coach.

**Head Coach Sidebar:**
- Dashboard
- Club Methodology (head coach only)
- My Methodology
- Session Planning
- My Team
  - Players
  - Team Settings
- Club Settings (above logout)
- Logout

**Regular Coach Sidebar:**
- Dashboard
- My Methodology
- Session Planning
- My Team
  - Players
  - Team Settings
- Coach Settings (above logout)
- Logout


---

## Club Methodology (Head Coach Only)

Head coaches have an additional sidebar section called "Club Methodology". This section is structured exactly the same as "My Methodology" with the same three categories:
1. Playing Methodology
2. Training Methodology
3. Positional Profiling

When any new team is created within the club, they automatically inherit the Club Methodology as the base/starting point for all three sections. Coaches can then customize their team's methodology from there (by adding on top), but the club-level defaults are set by the head coach.

Non-head coaches do not have access to the Club Methodology section - they only see "My Methodology" for their specific team(s).


---

## Methodology

Methodology is getting a completely new overhaul. Renamed to "My Methodology"

Methodology tab be split into three categories:
1. Playing Methodology
2. Training Methodology
3. Positional Profiling

You can see the visuals of the section in general:

![My Methodology](./methodology-tab.png)

### Playing Methodology

How you want your team to play during matches.

- This would be a list of rules that are essentially supposed to be a list of Zones. Each rule has a title (Zone 1) and then a text description which would explain all of what that zone does.
- For all coaches, this will by default have all of their club playing zones. Head coaches can edit these, non-head coaches cannot. Head coaches can add a subtract club level zones/rules. Non-head coaches can add extra zones/playing rules, however, they can only edit/delete/add the rules that they add, and these extra rules apply to ONLY the team currently selected in the sidebar.
- Club rules will have a club badge next to them, team specific rules will not

The visual for what this will look like is:

![Playing Methodology](./playing-methodology.png)

### Training Methodology

How you plan to train your players, including practice design, coaching style, and key themes.

- This will be a simple list of rules that are used in training. Each rule has a title and then a text description of what the rule means.
- For all coaches, this will by default have all of their club training rules. Head coaches can edit these, non-head coaches cannot. Head coaches can add a subtract club level training rules. Non-head coaches can add extra training rules, however, they can only edit/delete/add the rules that they add, and these extra rules apply to ONLY the team currently selected in the sidebar.

The visual for what this will look like is the same the playing methodology, just boxes of rules.

### Positional Profiling

Clear descriptions of each position that align with your playing style and team structure.

When a new team is created, the positional profiling is automatically copied from the Club Methodology standard. Coaches can then edit their team's copy from there. Head coaches have access to both Club-level positional profiling (in Club Methodology) and Team-level positional profiling (in My Methodology for each of their teams).

- List of positions that can be expanded to see all positions available
- "Advanced options" with descriptions (e.g., Inverted Fullback, Defensive Fullback, etc.), as well as an option to "suggest new" where coaches can suggest a new position for review
- Coach can "activate/deactivate" positions
- When expanded, coach can see a dropdown to select a maximum of 5 attributes they feel are most important to that position
- Default attributes are pre-selected but coach can adapt by ticking/unticking - cannot have more than 5 selected
- Option to add additional custom attributes at the end of the list

The visual for what this will look like is:

![Positional Profiling](./positional-profiling.png)

They will be able to edit what positions are selected for profiles with this pop-up modal:

![Edit Positions](./edit-positions.png)


---

## Team Settings

Team Settings appears in the sidebar under "My Team". It contains all team-specific configuration. When creating a new team, there is a flow that guides through all settings.

For methodology sections (Playing, Training, Positional Profiling): the team automatically inherits club standards, and coaches can only add extras on top.

For facilities and coach assignment: these are team-specific and must be configured per team.

### Facilities

- **"How much space do you have?"** - dropdown list of options:
  - Full Pitch
  - Half Pitch
  - Quarter Pitch
  - Indoor Hall
  - Other (free text input)
- **"What equipment do you have access to?"** - select equipment type and quantity (e.g., Full size goal, 2). Default equipment types:
  - Full Size Goal
  - Mini Goal
  - Cones
  - Balls
  - Bibs
  - Mannequins
  - Poles
  - Ladders
  - Hurdles
  - (Coaches can add custom equipment types)
- **"Are there any other factors to consider about your session?"** - open text field where they can write any answer

![My Facilities](./my-facilities.png)

### Coach Assignment

- Assign multiple coaches to the team (no limit)
- Assigned coaches get:
  - Access to view and edit the team's data
  - Ability to edit team details
  - Ability to create and manage sessions for that team
- Only the head coach or team creator can add/remove coaches from a team


---

## Dashboard

The Dashboard tab provides an overview of recent and upcoming sessions.

- Box showing the most recent past session and the upcoming session
- "View all previous sessions" button opens a page with all previous sessions
  - Coach can expand both the session plan and reflections for each session
  - Includes all details about the session
- Past sessions are highlighted if the coach has not yet reflected on them
- "Review session" button opens a new page with:
  - List of reflection questions for the coach to answer
  - Button to record audio of their voice, which is then displayed for them
  - (Nice to have: audio could be summarized and assigned to individuals or the team)


---

## Session Planning (formerly "Sessions")

The "Sessions" tab is renamed to "Session Planning".

- View the next session, as well as future sessions and previous completed sessions
- When opening an incomplete session:
  - Some predetermined information is already filled in based on methodology
  - View session blocks (number determined by their methodology)
  - Click on each block to edit that part of the session
  - AI Coach appears to prompt around session setup
  - Coach can ask direct questions to support their session planning
  - Export the entire session as a PDF
  - "Suggestions" icon showing:
    - Coach's own suggestions they have set
    - AI suggestions from methodology and analysis
  - Data point prompts for targets they are aiming for or not hitting

### Session Blocks Architecture

Session blocks are **reusable content units** that coaches can create, save, and use across multiple sessions. This allows coaches to build a personal library of drills, exercises, and activities.

**Block Content:**
- `title` - Name of the block/drill
- `description` - Detailed explanation of the activity
- `coaching_points` - Key coaching cues and focus areas
- `image_url` - Visual diagram or photo of the setup
- `diagram_data` - Structured data for interactive pitch diagrams
- `duration` - Estimated time in minutes

**Ownership & Sharing:**
- `creator_id` - The coach who created the block
- `club_id` - Optional club association for shared blocks
- `is_public` - Whether the block is visible to other coaches
- `source` - Origin of the block:
  - `user` - Created by a coach
  - `system` - Pre-built blocks provided by VIA
  - `marketplace` - Blocks from future marketplace feature

**Block Assignments:**
Blocks are linked to sessions via `session_block_assignments`, which tracks:
- Which block is used in which session
- The `position` (order) of the block within the session

This many-to-many relationship allows:
- The same block to be reused across multiple sessions
- Coaches to build a personal block library over time
- Future marketplace features for sharing/purchasing blocks

**NOTE: The full Session Planning and post-session analysis implementation will be done after completing all structural work (Club system, Methodology, My Team).**


---

## My Team

The "Players" tab will be renamed to "My Team". It has two sub-sections:
1. **Players** - manage players and their IDPs
2. **Team Settings** - team-specific configuration (facilities, coach assignment)

### Players Sub-Section

- Coaches can add players to their group and assign them a position
- From this, coaches can assign IDPs (Individual Development Plans) based on that position
- The positions available and the IDPs suggested come from the lists selected in Positional Profiling in "My Methodology"
- If Positional Profiling hasn't been configured, default positions and IDP options will be shown
- Coaches can add their own custom IDP
- A "?" button at the top of the list explains that the list comes from Positional Profiling within "My Methodology", and if they want to edit the list they can

### Analysis Sub-Tab

- A page showing data regarding the team's outcomes
- Dropdown to select a player's name to see that individual player's training data
- Permanent "Suggestions" button which suggests areas the coach has not focused on based on how often they have worked on the players' IDPs
- Coach can select a suggestion and add it to their planning to inform the next session
- Can assign to all future sessions or select specific sessions to assign it to
- When there is not much data collected, display message: "Insufficient data to assess. Please come back once more has been collected"


---

## Club Settings (Head Coach Only)

Club Settings appears in the sidebar above the Logout button. This is only visible to head coaches.

**Coach Profile:**
- View and edit the head coach's own profile information
- Profile picture, name, email, role, etc.

**Sub Coaches:**
- View all coaches in the club
- See which teams each coach is assigned to
- Add new coaches to the club (generates invite/club code)
- Remove coaches from the club
- Edit coach roles and permissions

**Club Information:**
- Club name and branding
- Club code for inviting new coaches
- Other club-level settings

All sections are fully editable by the head coach.


---

## Coach Settings (Regular Coaches Only)

For non-head coaches, this section is called "Coach Settings" and appears in the same location (above Logout).

**Coach Profile:**
- View and edit their own profile information
- Profile picture, name, email, etc.

Regular coaches cannot see or manage other coaches in the club, and cannot access club-level settings.


---

## Future Implementation: IDP Feedback Loop

After completing the structural work above, we will implement the Session ↔ IDP feedback loop:

- When coaches complete post-session reflections/comments, an LLM analysis runs to categorize the session
- The analysis determines which parts of each player's IDP were worked on during that session (if any)
- This data feeds into the Analysis sub-tab to power the "Suggestions" feature
- Coaches can see how frequently each IDP target has been addressed across sessions

This creates a closed loop: Methodology → Sessions → Reflection → Analysis → Suggestions → Future Sessions


---

# Technical Decisions

This section documents all technical decisions made during planning.

## 1. Data Migration

**Decision:** Fresh start - no existing users to migrate. We will create a new database schema from scratch without backward compatibility concerns.

## 2. Club Code Format

**Decision:** Club codes are **6 characters, alphanumeric, randomly generated**.

Example: `A7X9K2`, `B3M8P1`

Generation should avoid ambiguous characters (0/O, 1/I/l) for readability.

## 3. Methodology Inheritance Behavior

**Decision:** **Live reference (Option B)** - Club rules are always visible and applied to all teams. Coaches cannot edit or remove club rules, only add extra team-specific rules on top.

- Club rules display with a club badge indicator
- Team-specific rules do not have the badge
- When head coach updates club methodology, changes propagate to all teams in real-time
- When a team is created, it automatically sees all club methodology (no copy needed for Playing/Training rules)
- For Positional Profiling specifically: team gets a copy that can be customized, but club defaults are the starting point

## 4. Real-Time Sync

**Decision:** All methodology changes by head coach propagate in real-time to coaches viewing their team methodology. We will use Supabase Realtime subscriptions (already used extensively in current implementation).

## 5. Confirmation Dialogs

**Decision:** Require confirmation dialogs for all destructive/sensitive actions:

- Head coach deleting their club
- Head coach transferring head coach role to another coach
- Head coach removing a coach from the club
- Removing the only coach from a team
- Deleting a team
- Deleting a player

## 6. Defaults & Templates Architecture

**Decision:** Two-table system for maximum flexibility and future monetization.

### System Defaults Table

For basic editable defaults (positions, attributes, equipment, space options). Simple key-value structure with JSONB for flexibility.

```sql
CREATE TABLE system_defaults (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  category TEXT NOT NULL,  -- 'positions', 'attributes', 'equipment', 'space_options'
  key TEXT NOT NULL,       -- 'goalkeeper', 'tackling', 'full_size_goal'
  value JSONB NOT NULL,    -- Flexible structure per category
  display_order INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(category, key)
);
```

**Example Data:**

```sql
-- Positions with default attributes
INSERT INTO system_defaults (category, key, value, display_order) VALUES
('positions', 'goalkeeper', '{
  "name": "Goalkeeper",
  "abbreviation": "GK",
  "is_advanced": false,
  "default_attributes": ["shot_stopping", "distribution", "positioning", "communication", "aerial_ability"]
}', 1),
('positions', 'centre_back', '{
  "name": "Centre Back",
  "abbreviation": "CB",
  "is_advanced": false,
  "default_attributes": ["tackling", "heading", "positioning", "passing", "leadership"]
}', 2),
('positions', 'inverted_fullback', '{
  "name": "Inverted Fullback",
  "abbreviation": "IFB",
  "is_advanced": true,
  "parent_position": "fullback",
  "default_attributes": ["positioning", "passing", "ball_retention", "tactical_awareness", "composure"]
}', 10);

-- Attributes
INSERT INTO system_defaults (category, key, value, display_order) VALUES
('attributes', 'tackling', '{"name": "Tackling", "description": "Ability to win the ball from opponents"}', 1),
('attributes', 'passing', '{"name": "Passing", "description": "Accuracy and range of passing"}', 2),
('attributes', 'vision', '{"name": "Vision", "description": "Awareness of teammates and space"}', 3);

-- Equipment
INSERT INTO system_defaults (category, key, value, display_order) VALUES
('equipment', 'full_size_goal', '{"name": "Full Size Goal"}', 1),
('equipment', 'mini_goal', '{"name": "Mini Goal"}', 2),
('equipment', 'cones', '{"name": "Cones"}', 3),
('equipment', 'balls', '{"name": "Balls"}', 4),
('equipment', 'bibs', '{"name": "Bibs"}', 5),
('equipment', 'mannequins', '{"name": "Mannequins"}', 6),
('equipment', 'poles', '{"name": "Poles"}', 7),
('equipment', 'ladders', '{"name": "Ladders"}', 8),
('equipment', 'hurdles', '{"name": "Hurdles"}', 9);

-- Space Options
INSERT INTO system_defaults (category, key, value, display_order) VALUES
('space_options', 'full_pitch', '{"name": "Full Pitch"}', 1),
('space_options', 'half_pitch', '{"name": "Half Pitch"}', 2),
('space_options', 'quarter_pitch', '{"name": "Quarter Pitch"}', 3),
('space_options', 'indoor_hall', '{"name": "Indoor Hall"}', 4);
```

### Methodology Templates Table (Future)

For purchasable/selectable methodology packages (QPR, FC Barcelona, etc.). Structure ready but UI deferred.

```sql
CREATE TABLE methodology_templates (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name TEXT NOT NULL,           -- "QPR Academy Training Methodology"
  source TEXT NOT NULL,         -- "QPR", "FC Barcelona", "VIA"
  template_type TEXT NOT NULL,  -- 'playing', 'training', 'positional', 'full_bundle'
  content JSONB NOT NULL,       -- The actual methodology content
  description TEXT,
  logo_url TEXT,
  is_premium BOOLEAN DEFAULT false,
  price_cents INTEGER,          -- Future monetization
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

**Benefits:**
- Easy to edit defaults without code changes
- Admin UI can be built for non-technical editing
- Templates table ready for future marketplace features
- JSONB allows flexible structures per category
- Clear separation between system defaults and purchasable content

## 7. Routing Architecture

**Decision:** Move to **Next.js file-based routing** with route groups.

### Why Now

- Major restructure is the ideal time to change routing
- New club/team structure naturally maps to URL routes
- Benefits outweigh migration cost

### Benefits

| Feature | Current (View State) | File-Based Routing |
|---------|---------------------|-------------------|
| Shareable URLs | No | Yes (`/my-team/players/abc123`) |
| Back button | No | Yes |
| Deep linking | No | Yes |
| Code organization | Single large page | Clear file structure |
| Loading states | Manual | Built-in `loading.tsx` |
| Error boundaries | Manual | Built-in `error.tsx` |
| Sidebar persistence | Yes | Yes (via layout) |
| Page transitions | Yes (Framer) | Yes (Framer + `template.tsx`) |

### Route Structure

```
src/app/
├── (auth)/                         # No sidebar, centered layout
│   ├── layout.tsx
│   ├── login/page.tsx              # /login
│   ├── verify/page.tsx             # /verify (OTP)
│   ├── join/page.tsx               # /join (enter club code)
│   └── onboarding/page.tsx         # /onboarding
│
├── (dashboard)/                    # Sidebar layout
│   ├── layout.tsx                  # Contains <Sidebar /> + main content area
│   ├── page.tsx                    # / (Dashboard)
│   │
│   ├── club-methodology/           # Head coach only
│   │   ├── page.tsx                # /club-methodology (redirects to /playing)
│   │   ├── playing/page.tsx        # /club-methodology/playing
│   │   ├── training/page.tsx       # /club-methodology/training
│   │   └── profiling/page.tsx      # /club-methodology/profiling
│   │
│   ├── methodology/                # Team methodology ("My Methodology")
│   │   ├── page.tsx                # /methodology (redirects to /playing)
│   │   ├── playing/page.tsx        # /methodology/playing
│   │   ├── training/page.tsx       # /methodology/training
│   │   └── profiling/page.tsx      # /methodology/profiling
│   │
│   ├── session-planning/
│   │   ├── page.tsx                # /session-planning (list view)
│   │   └── [id]/page.tsx           # /session-planning/abc123 (detail view)
│   │
│   ├── my-team/
│   │   ├── players/
│   │   │   ├── page.tsx            # /my-team/players (list)
│   │   │   └── [id]/page.tsx       # /my-team/players/abc123 (detail)
│   │   ├── settings/page.tsx       # /my-team/settings
│   │   └── analysis/page.tsx       # /my-team/analysis
│   │
│   └── settings/
│       ├── page.tsx                # /settings (coach profile)
│       ├── club/page.tsx           # /settings/club (head coach only - club info)
│       └── coaches/page.tsx        # /settings/coaches (head coach only - manage coaches)
│
└── api/
    └── ai/coach/route.ts
```

### Sidebar Implementation

The sidebar lives in `(dashboard)/layout.tsx` and uses `usePathname()` for active state:

```tsx
// src/app/(dashboard)/layout.tsx
export default function DashboardLayout({ children }) {
  return (
    <div style={{ display: 'flex', height: '100vh' }}>
      <Sidebar />
      <main style={{ flex: 1, overflow: 'auto' }}>
        {children}
      </main>
    </div>
  )
}
```

### Migration Approach

Routes will be built incrementally as each phase is implemented. Old view-state code can coexist during transition.

## 8. Session Blocks Architecture

**Decision:** Implement session blocks as **reusable content units** with a many-to-many relationship to sessions.

### Why Reusable Blocks

- Coaches frequently reuse the same drills/exercises across sessions
- Building a library saves time and ensures consistency
- Enables future marketplace/sharing features
- Allows system-provided blocks alongside user-created ones

### Database Structure

**`session_blocks` table:**
```sql
CREATE TABLE session_blocks (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  -- Content fields
  title TEXT NOT NULL,
  description TEXT,
  coaching_points TEXT,
  image_url TEXT,
  diagram_data JSONB,
  duration INTEGER,
  -- Ownership & visibility
  creator_id UUID NOT NULL REFERENCES coaches(id),
  club_id UUID REFERENCES clubs(id),
  is_public BOOLEAN DEFAULT FALSE,
  source TEXT DEFAULT 'user' CHECK (source IN ('user', 'system', 'marketplace')),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

**`session_block_assignments` table:**
```sql
CREATE TABLE session_block_assignments (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  session_id UUID NOT NULL REFERENCES sessions(id) ON DELETE CASCADE,
  block_id UUID NOT NULL REFERENCES session_blocks(id) ON DELETE CASCADE,
  position INTEGER NOT NULL DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(session_id, block_id)
);
```

### Access Rules

- Coaches can view: their own blocks, club blocks, public blocks, system blocks
- Coaches can edit/delete: only their own blocks
- Blocks can be assigned to any session the coach has access to

### Benefits

- Blocks are created once, used many times
- Clear ownership model supports future monetization
- `source` field distinguishes user vs system vs marketplace content
- `diagram_data` JSONB allows rich interactive pitch diagrams


---

# Implementation Plan

## Phase 1: Database Schema Restructure

**Goal:** Create the new club-centric database schema.

### New Tables to Create

1. **`clubs`** - Club entities
   ```sql
   - id UUID PRIMARY KEY
   - name TEXT NOT NULL
   - code TEXT UNIQUE NOT NULL (6 chars, alphanumeric)
   - logo_url TEXT
   - created_at TIMESTAMPTZ
   - updated_at TIMESTAMPTZ
   ```

2. **`club_memberships`** - Coach-club relationships
   ```sql
   - id UUID PRIMARY KEY
   - club_id UUID REFERENCES clubs
   - coach_id UUID REFERENCES coaches
   - role TEXT (e.g., 'Assistant Coach', 'Goalkeeping Coach')
   - is_head_coach BOOLEAN DEFAULT false
   - joined_at TIMESTAMPTZ
   - UNIQUE(club_id, coach_id)
   ```

3. **`team_coaches`** - Coach-team assignments (junction table)
   ```sql
   - id UUID PRIMARY KEY
   - team_id UUID REFERENCES teams
   - coach_id UUID REFERENCES coaches
   - assigned_at TIMESTAMPTZ
   - UNIQUE(team_id, coach_id)
   ```

4. **`system_defaults`** - Editable system defaults (see Technical Decisions)

5. **`methodology_templates`** - Future templates (see Technical Decisions)

6. **`playing_methodology`** - Playing methodology rules
   ```sql
   - id UUID PRIMARY KEY
   - club_id UUID REFERENCES clubs (for club-level rules)
   - team_id UUID REFERENCES teams (for team-level rules, NULL for club)
   - title TEXT NOT NULL
   - description TEXT
   - display_order INTEGER
   - is_active BOOLEAN DEFAULT true
   - created_at TIMESTAMPTZ
   - updated_at TIMESTAMPTZ
   ```

7. **`training_methodology`** - Training methodology rules
   ```sql
   - id UUID PRIMARY KEY
   - club_id UUID REFERENCES clubs
   - team_id UUID REFERENCES teams (NULL for club-level)
   - title TEXT NOT NULL
   - description TEXT
   - display_order INTEGER
   - is_active BOOLEAN DEFAULT true
   - created_at TIMESTAMPTZ
   - updated_at TIMESTAMPTZ
   ```

8. **`positional_profiles`** - Club/team positional profiles
   ```sql
   - id UUID PRIMARY KEY
   - club_id UUID REFERENCES clubs
   - team_id UUID REFERENCES teams (NULL for club-level)
   - position_key TEXT NOT NULL (references system_defaults)
   - custom_position_name TEXT (for custom positions)
   - attributes JSONB (array of up to 5 attribute keys)
   - is_active BOOLEAN DEFAULT true
   - display_order INTEGER
   - created_at TIMESTAMPTZ
   - updated_at TIMESTAMPTZ
   ```

9. **`team_facilities`** - Team facility configuration
   ```sql
   - id UUID PRIMARY KEY
   - team_id UUID REFERENCES teams
   - space_type TEXT
   - custom_space TEXT (if space_type is 'other')
   - equipment JSONB (array of {type, quantity})
   - other_factors TEXT
   - created_at TIMESTAMPTZ
   - updated_at TIMESTAMPTZ
   ```

10. **`position_suggestions`** - Coach suggestions for new positions
    ```sql
    - id UUID PRIMARY KEY
    - club_id UUID REFERENCES clubs
    - coach_id UUID REFERENCES coaches
    - suggested_name TEXT NOT NULL
    - description TEXT
    - status TEXT DEFAULT 'pending' (pending, approved, rejected)
    - created_at TIMESTAMPTZ
    ```

### Tables to Modify

1. **`coaches`** - Remove direct data ownership
   - Remove: (nothing to remove, but ownership shifts to club)
   - Keep: id, auth_user_id, email, name, profile_picture, position, onboarding_completed

2. **`teams`** - Change ownership to club
   - Add: `club_id UUID REFERENCES clubs`
   - Remove: `coach_id` (replaced by team_coaches junction)

3. **`players`** - Change ownership to club
   - Add: `club_id UUID REFERENCES clubs`
   - Keep: team_id (players belong to teams within club)
   - Remove: `coach_id` (ownership is via club)

4. **`sessions`** - Change ownership to club
   - Add: `club_id UUID REFERENCES clubs`
   - Keep: team_id, coach_id (coach who created the session)

5. **`coaching_rules`** - Will be replaced by new methodology tables
   - Mark as deprecated, migrate data to new tables

### RLS Policy Updates

All policies need to be rewritten for club-based access:
- Coaches can access data for clubs they are members of
- Head coaches have additional permissions (delete, manage coaches)
- Team-level access based on team_coaches junction table

### Tasks

1. Create new tables with proper constraints and indexes
2. Update existing tables with new columns
3. Create new RLS policies for club-based ownership
4. Seed system_defaults with initial data
5. Create helper functions for common queries

---

## Phase 2: Auth & Club System + Routing Setup

**Goal:** Update authentication flow and set up new routing structure.

### Auth Flow Updates

1. **New Login Flow:**
   - Email entry → OTP verification → Club selection
   - After OTP, check if user has existing club membership
   - If yes: redirect to dashboard
   - If no: show club selection (create new OR enter code)

2. **Create Club Flow:**
   - Enter club name
   - Auto-generate club code
   - User becomes head coach automatically
   - Proceed to onboarding (create first team)

3. **Join Club Flow:**
   - Enter 6-character club code
   - Validate code exists
   - Select role (Assistant Coach, Goalkeeping Coach, etc.)
   - Join club as regular coach
   - Proceed to team assignment or dashboard

4. **Club Code Generation:**
   - 6 alphanumeric characters
   - Avoid ambiguous characters (0/O, 1/I/l)
   - Check uniqueness before saving

### Routing Setup

1. Create route group structure:
   - `(auth)/` - Login, verify, join, onboarding
   - `(dashboard)/` - All authenticated routes

2. Create layouts:
   - `(auth)/layout.tsx` - Centered, no sidebar
   - `(dashboard)/layout.tsx` - With sidebar

3. Create initial pages:
   - `/login` - Email entry
   - `/verify` - OTP entry
   - `/join` - Club code entry
   - `/onboarding` - Team creation wizard
   - `/` - Dashboard (placeholder)

4. Update AuthContext:
   - Add club and membership info
   - Add isHeadCoach helper
   - Add current team selection

### Tasks

1. Set up Next.js route group structure
2. Create auth layout and dashboard layout
3. Build login page with email entry
4. Build OTP verification page
5. Build club selection page (create vs join)
6. Build club creation flow
7. Build club join flow
8. Update AuthContext with club/role info
9. Create Sidebar component with role-based rendering
10. Set up middleware for auth protection

---

## Phase 3: Settings Pages

**Goal:** Build settings pages for both head coaches and regular coaches.

### Club Settings (Head Coach Only)

Route: `/settings/club` and `/settings/coaches`

1. **Coach Profile Section** (`/settings`)
   - Profile picture upload
   - Name editing
   - Email display (read-only)
   - Role/position editing

2. **Sub Coaches Management** (`/settings/coaches`)
   - List all coaches in club
   - Show team assignments per coach
   - Add new coach (display club code for sharing)
   - Remove coach from club (with confirmation)
   - Edit coach roles

3. **Club Information** (`/settings/club`)
   - Club name editing
   - Club logo upload
   - Display club code (with copy button)
   - Transfer head coach role (with confirmation)
   - Delete club (with confirmation)

### Coach Settings (Regular Coach)

Route: `/settings`

1. **Coach Profile Only**
   - Profile picture upload
   - Name editing
   - Email display (read-only)
   - View current role (read-only)
   - View club name (read-only)

### Tasks

1. Build `/settings` page (coach profile - works for both roles)
2. Build `/settings/club` page (head coach only)
3. Build `/settings/coaches` page (head coach only)
4. Implement role-based route protection
5. Build confirmation modals for destructive actions
6. Update sidebar to show correct settings link based on role

---

## Phase 4: Club Methodology (Head Coach)

**Goal:** Build the Club Methodology section for head coaches.

### Routes

- `/club-methodology` - Overview/redirect
- `/club-methodology/playing` - Playing methodology
- `/club-methodology/training` - Training methodology
- `/club-methodology/profiling` - Positional profiling

### Playing Methodology UI

1. List of "zones" (rules) with title and description
2. Add new zone button
3. Edit zone (inline or modal)
4. Delete zone (with confirmation)
5. Reorder zones (drag and drop)
6. All rules have club badge indicator

### Training Methodology UI

1. List of training rules with title and description
2. Add new rule button
3. Edit rule (inline or modal)
4. Delete rule (with confirmation)
5. Reorder rules
6. All rules have club badge indicator

### Positional Profiling UI

1. List of positions (from system_defaults)
2. Activate/deactivate positions
3. Expand position to see/edit attributes
4. Select up to 5 attributes per position
5. Add custom attributes
6. "Edit Positions" modal for bulk activation
7. "Advanced options" section for advanced positions
8. "Suggest new position" option

### Tasks

1. Build club methodology layout with sub-navigation
2. Build playing methodology page with CRUD operations
3. Build training methodology page with CRUD operations
4. Build positional profiling page
5. Build position edit modal
6. Build attribute selection UI (max 5)
7. Implement real-time sync for all methodology changes
8. Create club badge indicator component

---

## Phase 5: Team Creation & Settings

**Goal:** Build team creation flow and team settings page.

### Team Creation Flow

1. **Triggered when:**
   - New club created (first team during onboarding)
   - "Add Team" button in sidebar/settings

2. **Steps:**
   - Team name
   - Age group
   - Skill level
   - Player count
   - Sessions per week
   - Session duration
   - Gender (optional)

3. **After creation:**
   - Team inherits club methodology
   - Team appears in sidebar
   - Redirect to team settings for facilities setup

### Team Settings Page

Route: `/my-team/settings`

1. **Team Information**
   - Edit team name, age group, skill level, etc.
   - Delete team (head coach only, with confirmation)

2. **Facilities Section**
   - Space dropdown (Full Pitch, Half Pitch, Quarter Pitch, Indoor Hall, Other)
   - Equipment list with quantities
   - Add custom equipment types
   - Other factors text field

3. **Coach Assignment Section**
   - List assigned coaches
   - Add coaches from club (head coach or team creator only)
   - Remove coaches (head coach or team creator only)

### Team Selector in Sidebar

- Dropdown or expandable list showing all teams coach has access to
- Current team highlighted
- Clicking team switches context for My Methodology, My Team, Session Planning

### Tasks

1. Build team creation modal/flow
2. Build team settings page
3. Build facilities section with equipment management
4. Build coach assignment section
5. Implement team selector in sidebar
6. Update all team-related pages to use selected team context
7. Handle team switching and state management

---

## Phase 6: My Methodology (Team-Level)

**Goal:** Build team-level methodology that inherits from club.

### Routes

- `/methodology` - Overview/redirect
- `/methodology/playing` - Team playing methodology
- `/methodology/training` - Team training methodology
- `/methodology/profiling` - Team positional profiling

### Key Differences from Club Methodology

1. **Club rules are displayed but not editable**
   - Show with club badge
   - No edit/delete buttons for club rules

2. **Team-specific rules can be added**
   - No club badge
   - Full CRUD for coach's own rules

3. **For head coaches:**
   - See both club rules and team rules
   - Can add team-specific rules
   - Link to edit club rules in Club Methodology

4. **For regular coaches:**
   - See club rules (read-only)
   - Can add/edit/delete their own team rules only

### Positional Profiling Specifics

- Team gets a customizable copy based on club defaults
- Can activate/deactivate positions for this team
- Can customize attributes for this team
- Changes don't affect club-level profiles

### Tasks

1. Build team methodology pages (playing, training, profiling)
2. Implement dual display (club rules + team rules)
3. Add club badge component to club rules
4. Implement permission checks (edit only own rules)
5. Link IDP suggestions to positional profiling attributes
6. Real-time sync for team methodology changes

---

## Phase 7: My Team / Players

**Goal:** Build player management with IDP integration.

### Routes

- `/my-team/players` - Player list
- `/my-team/players/[id]` - Player detail
- `/my-team/analysis` - Team analysis (deferred full implementation)

### Players List Page

1. List all players on current team
2. Add new player button
3. Search/filter players
4. Show position and IDP status for each

### Player Detail Page

1. **Player Information**
   - Name, age, gender
   - Position (dropdown from team's positional profiling)

2. **Individual Development Plan (IDP)**
   - Up to 3 development targets
   - Suggestions based on position's attributes
   - Custom IDP option
   - "?" tooltip explaining IDP source

3. **Player Actions**
   - Edit player info
   - Delete player (head coach only)
   - Move to different team (within club)

### Add Player Flow

1. Enter name
2. Select position (from team's active positions)
3. Optionally set age, gender
4. Optionally set initial IDP targets

### Tasks

1. Build players list page
2. Build player detail page
3. Build add player modal/flow
4. Implement IDP selection from positional profiling
5. Build analysis page placeholder
6. Implement player move between teams

---

## Phase 8: Dashboard & Session Planning Updates

**Goal:** Update existing features to work with new club/team structure.

### Dashboard Updates

Route: `/`

1. Show sessions for current team
2. Recent session and upcoming session cards
3. "View all sessions" link to session planning
4. Team stats (players, sessions this week, etc.)
5. Quick actions (add session, add player)

### Session Planning Updates

Routes: `/session-planning`, `/session-planning/[id]`

1. List sessions for current team
2. Filter by upcoming/past
3. Session creation uses team context
4. Session detail includes team info
5. AI coach receives team methodology context

### What's Deferred

- Full session reflection system
- Audio recording for reflections
- Analysis sub-tab with IDP tracking
- LLM-powered session categorization
- Suggestions engine

### Tasks

1. Update dashboard to use team context
2. Update session list to filter by team
3. Update session creation to use team
4. Update AI coach context with new methodology structure
5. Ensure all session queries use club ownership

---

## Phase Summary

| Phase | Focus | Key Deliverables |
|-------|-------|------------------|
| 1 | Database | New schema, tables, RLS policies |
| 2 | Auth + Routing | Club system, route structure, layouts |
| 3 | Settings | Club/Coach settings pages |
| 4 | Club Methodology | Head coach methodology management |
| 5 | Team Creation | Team flow, settings, facilities |
| 6 | Team Methodology | Inherited + team-specific rules |
| 7 | Players | Player management, IDP integration |
| 8 | Dashboard/Sessions | Update existing features |

---

## Appendix: Default Positions (To Be Expanded)

### Standard Positions

- Goalkeeper (GK)
- Centre Back (CB)
- Full Back (FB)
- Defensive Midfielder (DM)
- Central Midfielder (CM)
- Attacking Midfielder (AM)
- Winger (W)
- Striker (ST)

### Advanced Position Variants (examples)

- Sweeper Keeper
- Ball-Playing Centre Back
- Inverted Full Back
- Defensive Full Back
- Box-to-Box Midfielder
- Deep-Lying Playmaker
- Inside Forward
- False Nine
- Target Man

*Full list of advanced positions and their default attributes to be provided separately.*

---

## Appendix: Default Attributes (To Be Expanded)

### Technical

- Passing
- Dribbling
- First Touch
- Crossing
- Shooting
- Heading
- Tackling
- Ball Control

### Physical

- Pace
- Strength
- Stamina
- Agility
- Balance
- Jumping

### Mental

- Vision
- Positioning
- Decision Making
- Leadership
- Communication
- Composure
- Tactical Awareness
- Work Rate

*Full list of attributes with descriptions to be provided separately.*
